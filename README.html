<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
               "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>GLCV</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
<meta name="title" content="GLCV"/>
<meta name="generator" content="Org-mode"/>
<meta name="generated" content="2011-10-02 Sun"/>
<meta name="author" content="Jorge Acereda"/>
<meta name="description" content=""/>
<meta name="keywords" content=""/>
<style type="text/css">
 <!--/*--><![CDATA[/*><!--*/
  html { font-family: Times, serif; font-size: 12pt; }
  .title  { text-align: center; }
  .todo   { color: red; }
  .done   { color: green; }
  .tag    { background-color: #add8e6; font-weight:normal }
  .target { }
  .timestamp { color: #bebebe; }
  .timestamp-kwd { color: #5f9ea0; }
  .right  {margin-left:auto; margin-right:0px;  text-align:right;}
  .left   {margin-left:0px;  margin-right:auto; text-align:left;}
  .center {margin-left:auto; margin-right:auto; text-align:center;}
  p.verse { margin-left: 3% }
  pre {
	border: 1pt solid #AEBDCC;
	background-color: #F3F5F7;
	padding: 5pt;
	font-family: courier, monospace;
        font-size: 90%;
        overflow:auto;
  }
  table { border-collapse: collapse; }
  td, th { vertical-align: top;  }
  th.right  { text-align:center;  }
  th.left   { text-align:center;   }
  th.center { text-align:center; }
  td.right  { text-align:right;  }
  td.left   { text-align:left;   }
  td.center { text-align:center; }
  dt { font-weight: bold; }
  div.figure { padding: 0.5em; }
  div.figure p { text-align: center; }
  div.inlinetask {
    padding:10px;
    border:2px solid gray;
    margin:10px;
    background: #ffffcc;
  }
  textarea { overflow-x: auto; }
  .linenr { font-size:smaller }
  .code-highlighted {background-color:#ffff00;}
  .org-info-js_info-navigation { border-style:none; }
  #org-info-js_console-label { font-size:10px; font-weight:bold;
                               white-space:nowrap; }
  .org-info-js_search-highlight {background-color:#ffff00; color:#000000;
                                 font-weight:bold; }
  /*]]>*/-->
</style>
<script type="text/javascript">
/*
@licstart  The following is the entire license notice for the
JavaScript code in this tag.

Copyright (C) 2012-2013 Free Software Foundation, Inc.

The JavaScript code in this tag is free software: you can
redistribute it and/or modify it under the terms of the GNU
General Public License (GNU GPL) as published by the Free Software
Foundation, either version 3 of the License, or (at your option)
any later version.  The code is distributed WITHOUT ANY WARRANTY;
without even the implied warranty of MERCHANTABILITY or FITNESS
FOR A PARTICULAR PURPOSE.  See the GNU GPL for more details.

As additional permission under GNU GPL version 3 section 7, you
may distribute non-source (e.g., minimized or compacted) forms of
that code without the copy of the GNU GPL normally required by
section 4, provided you include this license notice and a URL
through which recipients can access the Corresponding Source.


@licend  The above is the entire license notice
for the JavaScript code in this tag.
*/
<!--/*--><![CDATA[/*><!--*/
 function CodeHighlightOn(elem, id)
 {
   var target = document.getElementById(id);
   if(null != target) {
     elem.cacheClassElem = elem.className;
     elem.cacheClassTarget = target.className;
     target.className = "code-highlighted";
     elem.className   = "code-highlighted";
   }
 }
 function CodeHighlightOff(elem, id)
 {
   var target = document.getElementById(id);
   if(elem.cacheClassElem)
     elem.className = elem.cacheClassElem;
   if(elem.cacheClassTarget)
     target.className = elem.cacheClassTarget;
 }
/*]]>*///-->
</script>

</head>
<body>

<div id="preamble">

</div>

<div id="content">
<h1 class="title">GLCV</h1>


<div id="table-of-contents">
<h2>Table of Contents</h2>
<div id="text-table-of-contents">
<ul>
<li><a href="#sec-1">1 Purpose</a></li>
<li><a href="#sec-2">2 Building</a>
<ul>
<li><a href="#sec-2-1">2.1 IOS</a></li>
<li><a href="#sec-2-2">2.2 Android</a></li>
<li><a href="#sec-2-3">2.3 NPAPI</a></li>
<li><a href="#sec-2-4">2.4 Xlib</a></li>
<li><a href="#sec-2-5">2.5 Cocoa</a></li>
<li><a href="#sec-2-6">2.6 Windows</a></li>
</ul>
</li>
<li><a href="#sec-3">3 API</a>
<ul>
<li><a href="#sec-3-1">3.1 Functions</a>
<ul>
<li><a href="#sec-3-1-1">3.1.1 Application hook</a></li>
<li><a href="#sec-3-1-2">3.1.2 Application control</a></li>
<li><a href="#sec-3-1-3">3.1.3 Canvas queries</a></li>
<li><a href="#sec-3-1-4">3.1.4 Canvas control</a></li>
<li><a href="#sec-3-1-5">3.1.5 Mouse queries</a></li>
<li><a href="#sec-3-1-6">3.1.6 Mouse control</a></li>
<li><a href="#sec-3-1-7">3.1.7 Keyboard queries</a></li>
<li><a href="#sec-3-1-8">3.1.8 Keyboard control</a></li>
<li><a href="#sec-3-1-9">3.1.9 Logging</a></li>
<li><a href="#sec-3-1-10">3.1.10 Events</a></li>
</ul>
</li>
<li><a href="#sec-3-2">3.2 Events</a>
<ul>
<li><a href="#sec-3-2-1">3.2.1 CVE_NONE</a></li>
<li><a href="#sec-3-2-2">3.2.2 CVE_INIT</a></li>
<li><a href="#sec-3-2-3">3.2.3 CVE_TERM</a></li>
<li><a href="#sec-3-2-4">3.2.4 CVE_GLINIT</a></li>
<li><a href="#sec-3-2-5">3.2.5 CVE_GLTERM</a></li>
<li><a href="#sec-3-2-6">3.2.6 CVE_UPDATE</a></li>
<li><a href="#sec-3-2-7">3.2.7 CVE_RESIZE</a></li>
<li><a href="#sec-3-2-8">3.2.8 CVE_DOWN</a></li>
<li><a href="#sec-3-2-9">3.2.9 CVE_UP</a></li>
<li><a href="#sec-3-2-10">3.2.10 CVE_UNICODE</a></li>
<li><a href="#sec-3-2-11">3.2.11 CVE_MOTION</a></li>
<li><a href="#sec-3-2-12">3.2.12 CVE_CLOSE</a></li>
<li><a href="#sec-3-2-13">3.2.13 CVE_INVOKE</a></li>
</ul>
</li>
<li><a href="#sec-3-3">3.3 Queries</a>
<ul>
<li><a href="#sec-3-3-1">3.3.1 CVQ_NAME</a></li>
<li><a href="#sec-3-3-2">3.3.2 CVQ_LOGGER</a></li>
<li><a href="#sec-3-3-3">3.3.3 CVQ_XPOS</a></li>
<li><a href="#sec-3-3-4">3.3.4 CVQ_YPOS</a></li>
<li><a href="#sec-3-3-5">3.3.5 CVQ_WIDTH</a></li>
<li><a href="#sec-3-3-6">3.3.6 CVQ_HEIGHT</a></li>
</ul></li>
</ul>
</li>
<li><a href="#sec-4">4 Examples</a>
<ul>
<li><a href="#sec-4-1">4.1 Simple example that just draws</a></li>
<li><a href="#sec-4-2">4.2 Complete example handling all queries/events</a></li>
</ul>
</li>
<li><a href="#sec-5">5 License</a></li>
</ul>
</div>
</div>

<div id="outline-container-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Purpose</h2>
<div class="outline-text-2" id="text-1">

<p>GLCV is a small canvas/event handling library that provides a thin
layer abstracting the details of configuring the canvas and handling
input. Sort of a simple GLUT/SDL. No API is provided for
sound/fonts/widgets, there are good solutions out there for those and
freedom of choice is a good thing.
</p>
</div>

</div>

<div id="outline-container-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Building</h2>
<div class="outline-text-2" id="text-2">


</div>

<div id="outline-container-2-1" class="outline-3">
<h3 id="sec-2-1"><span class="section-number-3">2.1</span> IOS</h3>
<div class="outline-text-3" id="text-2-1">

<p>The following command should build the library and the examples and
install them in the IOS simulator directory.
</p>


<pre class="example">./mk-ios
</pre>

</div>

</div>

<div id="outline-container-2-2" class="outline-3">
<h3 id="sec-2-2"><span class="section-number-3">2.2</span> Android</h3>
<div class="outline-text-3" id="text-2-2">

<p>The following command should build the library and the examples and
install them in the Android emulator. The emulator must be running.
</p>


<pre class="example">./mk-android
</pre>

</div>

</div>

<div id="outline-container-2-3" class="outline-3">
<h3 id="sec-2-3"><span class="section-number-3">2.3</span> NPAPI</h3>
<div class="outline-text-3" id="text-2-3">

<p>The following command should build the library and the examples and
install them in the user's plugins directory.
</p>


<pre class="example">./mk-npapi
</pre>

<p>
After building, try opening <a href="testplugin.html">testplugin.html</a>
</p></div>

</div>

<div id="outline-container-2-4" class="outline-3">
<h3 id="sec-2-4"><span class="section-number-3">2.4</span> Xlib</h3>
<div class="outline-text-3" id="text-2-4">

<p>To compile the test application, use this command
</p>


<pre class="example">./mk-xlib
</pre>

</div>

</div>

<div id="outline-container-2-5" class="outline-3">
<h3 id="sec-2-5"><span class="section-number-3">2.5</span> Cocoa</h3>
<div class="outline-text-3" id="text-2-5">

<p>To compile the test application, use this command
</p>


<pre class="example">./mk-cocoa
</pre>

<p>
Or if you prefer to test the ARC version
</p>


<pre class="example">./mk-cocoa-arc
</pre>

</div>

</div>

<div id="outline-container-2-6" class="outline-3">
<h3 id="sec-2-6"><span class="section-number-3">2.6</span> Windows</h3>
<div class="outline-text-3" id="text-2-6">

<p>To compile the test application, use this command
</p>


<pre class="example">mk-win
</pre>

</div>
</div>

</div>

<div id="outline-container-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> API</h2>
<div class="outline-text-2" id="text-3">


</div>

<div id="outline-container-3-1" class="outline-3">
<h3 id="sec-3-1"><span class="section-number-3">3.1</span> Functions</h3>
<div class="outline-text-3" id="text-3-1">


</div>

<div id="outline-container-3-1-1" class="outline-4">
<h4 id="sec-3-1-1"><span class="section-number-4">3.1.1</span> Application hook</h4>
<div class="outline-text-4" id="text-3-1-1">




<pre class="example">intptr_t event(const ev * e);
</pre>

<p>
This is the event handling routine implemented by your application.
</p></div>

</div>

<div id="outline-container-3-1-2" class="outline-4">
<h4 id="sec-3-1-2"><span class="section-number-4">3.1.2</span> Application control</h4>
<div class="outline-text-4" id="text-3-1-2">




<pre class="example">void cvQuit();
</pre>

<p>
Call this to terminate your application.
</p></div>

</div>

<div id="outline-container-3-1-3" class="outline-4">
<h4 id="sec-3-1-3"><span class="section-number-4">3.1.3</span> Canvas queries</h4>
<div class="outline-text-4" id="text-3-1-3">




<pre class="example">unsigned cvWidth();
</pre>

<p>
Current canvas width
</p>


<pre class="example">unsigned cvHeight();
</pre>

<p>
Current canvas height
</p></div>

</div>

<div id="outline-container-3-1-4" class="outline-4">
<h4 id="sec-3-1-4"><span class="section-number-4">3.1.4</span> Canvas control</h4>
<div class="outline-text-4" id="text-3-1-4">




<pre class="example">void cvFullscreen();
</pre>

<p>
On platforms that support it, put the canvas in fullscreen mode.
</p>


<pre class="example">void cvWindowed();
</pre>

<p>
On platforms that support it, put the canvas in windowed mode.
</p></div>

</div>

<div id="outline-container-3-1-5" class="outline-4">
<h4 id="sec-3-1-5"><span class="section-number-4">3.1.5</span> Mouse queries</h4>
<div class="outline-text-4" id="text-3-1-5">




<pre class="example">int cvMouseX();
</pre>

<p>
Current X mouse position
</p>


<pre class="example">int cvMouseY();
</pre>

<p>
Current Y mouse position
</p></div>

</div>

<div id="outline-container-3-1-6" class="outline-4">
<h4 id="sec-3-1-6"><span class="section-number-4">3.1.6</span> Mouse control</h4>
<div class="outline-text-4" id="text-3-1-6">




<pre class="example">void cvSetCursor(const uint8_t * rgba, int hotx, int hoty);
</pre>

<p>
On platforms that support it, set the mouse cursor bitmap.  The rgba
argument is a pointer to a 32*32*4 bytes array containing 32x32 RGBA
pixels.
</p>


<pre class="example">void cvHideCursor();
</pre>

<p>
On platforms that support it, hide the mouse cursor.
</p>


<pre class="example">void cvDefaultCursor();
</pre>

<p>
On platforms that support it, establish the default mouse cursor.
</p></div>

</div>

<div id="outline-container-3-1-7" class="outline-4">
<h4 id="sec-3-1-7"><span class="section-number-4">3.1.7</span> Keyboard queries</h4>
<div class="outline-text-4" id="text-3-1-7">




<pre class="example">int cvPressed(cvkey key);
</pre>

<p>
True if key is currently pressed
</p>


<pre class="example">int cvReleased(cvkey key);
</pre>

<p>
True if key has just been released
</p></div>

</div>

<div id="outline-container-3-1-8" class="outline-4">
<h4 id="sec-3-1-8"><span class="section-number-4">3.1.8</span> Keyboard control</h4>
<div class="outline-text-4" id="text-3-1-8">




<pre class="example">void cvShowKeyboard();
</pre>

<p>
On platforms that support it, show the on-screen keyboard
</p>


<pre class="example">void cvHideKeyboard();
</pre>

<p>
On platforms that support it, hide the on-screen keyboard
</p></div>

</div>

<div id="outline-container-3-1-9" class="outline-4">
<h4 id="sec-3-1-9"><span class="section-number-4">3.1.9</span> Logging</h4>
<div class="outline-text-4" id="text-3-1-9">




<pre class="example">void cvReportV(const char * fmt, va_list ap);
</pre>

<p>
Report a message (depending on the platform, it might go to a file).
</p>


<pre class="example">void cvReport(const char * fmt, ...);
</pre>

<p>
Report a message (depending on the platform, it might go to a file).
</p></div>

</div>

<div id="outline-container-3-1-10" class="outline-4">
<h4 id="sec-3-1-10"><span class="section-number-4">3.1.10</span> Events</h4>
<div class="outline-text-4" id="text-3-1-10">




<pre class="example">int evType(const ev *);
</pre>

<p>
Event type.
</p>


<pre class="example">const char * evName(const ev *);
</pre>

<p>
Event name.
</p>


<pre class="example">int evWidth(const ev *);
</pre>

<p>
Width for CVE_RESIZE events.
</p>


<pre class="example">int evHeight(const ev *);
</pre>

<p>
Width for CVE_RESIZE events.
</p>


<pre class="example">cvkey evWhich(const ev *);
</pre>

<p>
Keycode associated to CVE_DOWN/CVE_UP events.
</p>


<pre class="example">int evX(const ev *);
</pre>

<p>
Mouse X position for CVE_DOWN/CVE_UP events.
</p>


<pre class="example">int evY(const ev *);
</pre>

<p>
Mouse Y position for CVE_DOWN/CVE_UP events.
</p>


<pre class="example">int evArgC(const ev *);
</pre>

<p>
Argument count for CVE_INIT events.
</p>


<pre class="example">char ** evArgV(const ev *);
</pre>

<p>
Argument array for CVE_INIT events.
</p>


<pre class="example">intptr_t evArg0(const ev *);
</pre>

<p>
First event argument, mostly internal.
</p>


<pre class="example">intptr_t evArg1(const ev *);
</pre>

<p>
Second event argument, mostly internal.
</p>


<pre class="example">intptr_t cvInject(cveventtype, intptr_t, intptr_t);
</pre>

<p>
Inject an event, mostly internal.
</p>


<pre class="example">const char * keyName(cvkey);
</pre>

<p>
Key name for CVE_DOWN/CVE_UP events.
</p></div>
</div>

</div>

<div id="outline-container-3-2" class="outline-3">
<h3 id="sec-3-2"><span class="section-number-3">3.2</span> Events</h3>
<div class="outline-text-3" id="text-3-2">


</div>

<div id="outline-container-3-2-1" class="outline-4">
<h4 id="sec-3-2-1"><span class="section-number-4">3.2.1</span> CVE_NONE</h4>
<div class="outline-text-4" id="text-3-2-1">

<p>Null event, must be ignored.
</p></div>

</div>

<div id="outline-container-3-2-2" class="outline-4">
<h4 id="sec-3-2-2"><span class="section-number-4">3.2.2</span> CVE_INIT</h4>
<div class="outline-text-4" id="text-3-2-2">

<p>Called upon initialization, no GL operations should be performed at this stage.
</p></div>

</div>

<div id="outline-container-3-2-3" class="outline-4">
<h4 id="sec-3-2-3"><span class="section-number-4">3.2.3</span> CVE_TERM</h4>
<div class="outline-text-4" id="text-3-2-3">

<p>Called before terminating the application.
</p></div>

</div>

<div id="outline-container-3-2-4" class="outline-4">
<h4 id="sec-3-2-4"><span class="section-number-4">3.2.4</span> CVE_GLINIT</h4>
<div class="outline-text-4" id="text-3-2-4">

<p>The OpenGL context has been established. Might be called several times.
</p></div>

</div>

<div id="outline-container-3-2-5" class="outline-4">
<h4 id="sec-3-2-5"><span class="section-number-4">3.2.5</span> CVE_GLTERM</h4>
<div class="outline-text-4" id="text-3-2-5">

<p>The OpenGL context is going to be destroyed. Might be called several times.
</p></div>

</div>

<div id="outline-container-3-2-6" class="outline-4">
<h4 id="sec-3-2-6"><span class="section-number-4">3.2.6</span> CVE_UPDATE</h4>
<div class="outline-text-4" id="text-3-2-6">

<p>This is your update routine, should be called at ~60Hz.
</p></div>

</div>

<div id="outline-container-3-2-7" class="outline-4">
<h4 id="sec-3-2-7"><span class="section-number-4">3.2.7</span> CVE_RESIZE</h4>
<div class="outline-text-4" id="text-3-2-7">

<p>Called when the canvas is resized. Might be called several times.
</p></div>

</div>

<div id="outline-container-3-2-8" class="outline-4">
<h4 id="sec-3-2-8"><span class="section-number-4">3.2.8</span> CVE_DOWN</h4>
<div class="outline-text-4" id="text-3-2-8">

<p>A key/button has been pressed.
</p></div>

</div>

<div id="outline-container-3-2-9" class="outline-4">
<h4 id="sec-3-2-9"><span class="section-number-4">3.2.9</span> CVE_UP</h4>
<div class="outline-text-4" id="text-3-2-9">

<p>A key/button has been released.
</p></div>

</div>

<div id="outline-container-3-2-10" class="outline-4">
<h4 id="sec-3-2-10"><span class="section-number-4">3.2.10</span> CVE_UNICODE</h4>
<div class="outline-text-4" id="text-3-2-10">

<p>Called when the user enters text.
</p></div>

</div>

<div id="outline-container-3-2-11" class="outline-4">
<h4 id="sec-3-2-11"><span class="section-number-4">3.2.11</span> CVE_MOTION</h4>
<div class="outline-text-4" id="text-3-2-11">

<p>The mouse moved.
</p></div>

</div>

<div id="outline-container-3-2-12" class="outline-4">
<h4 id="sec-3-2-12"><span class="section-number-4">3.2.12</span> CVE_CLOSE</h4>
<div class="outline-text-4" id="text-3-2-12">

<p>The application is about to close.
</p></div>

</div>

<div id="outline-container-3-2-13" class="outline-4">
<h4 id="sec-3-2-13"><span class="section-number-4">3.2.13</span> CVE_INVOKE</h4>
<div class="outline-text-4" id="text-3-2-13">

<p>Invoke method. The argument is available as evMethod().
</p></div>
</div>

</div>

<div id="outline-container-3-3" class="outline-3">
<h3 id="sec-3-3"><span class="section-number-3">3.3</span> Queries</h3>
<div class="outline-text-3" id="text-3-3">


</div>

<div id="outline-container-3-3-1" class="outline-4">
<h4 id="sec-3-3-1"><span class="section-number-4">3.3.1</span> CVQ_NAME</h4>
<div class="outline-text-4" id="text-3-3-1">

<p>Return the desired application name.
</p></div>

</div>

<div id="outline-container-3-3-2" class="outline-4">
<h4 id="sec-3-3-2"><span class="section-number-4">3.3.2</span> CVQ_LOGGER</h4>
<div class="outline-text-4" id="text-3-3-2">

<p>Function to be used for logging. The returned function prototype should be:
</p>


<pre class="example">void report(const char * appname, const char * string);
</pre>

</div>

</div>

<div id="outline-container-3-3-3" class="outline-4">
<h4 id="sec-3-3-3"><span class="section-number-4">3.3.3</span> CVQ_XPOS</h4>
<div class="outline-text-4" id="text-3-3-3">

<p>Return the desired X position. This is just a hint and can be ignored
on some platforms.
</p></div>

</div>

<div id="outline-container-3-3-4" class="outline-4">
<h4 id="sec-3-3-4"><span class="section-number-4">3.3.4</span> CVQ_YPOS</h4>
<div class="outline-text-4" id="text-3-3-4">

<p>Return the desired Y position. This is just a hint and can be ignored
on some platforms.
</p></div>

</div>

<div id="outline-container-3-3-5" class="outline-4">
<h4 id="sec-3-3-5"><span class="section-number-4">3.3.5</span> CVQ_WIDTH</h4>
<div class="outline-text-4" id="text-3-3-5">

<p>Return the desired width. Note that this is a hint and can be ignored
on some platforms. Your code should use the width reported via
CVE_RESIZE or ask explicitly with cvWidth().
</p></div>

</div>

<div id="outline-container-3-3-6" class="outline-4">
<h4 id="sec-3-3-6"><span class="section-number-4">3.3.6</span> CVQ_HEIGHT</h4>
<div class="outline-text-4" id="text-3-3-6">

<p>Return the desired height. Note that this is a hint and can be ignored
on some platforms. Your code should use the height reported via
CVE_RESIZE or ask explicitly with cvHeight().
</p></div>
</div>
</div>

</div>

<div id="outline-container-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Examples</h2>
<div class="outline-text-2" id="text-4">


</div>

<div id="outline-container-4-1" class="outline-3">
<h3 id="sec-4-1"><span class="section-number-3">4.1</span> Simple example that just draws</h3>
<div class="outline-text-3" id="text-4-1">




<pre class="example">#include "cv.h"
#include "cvgl.h"

static void update() {
        static int i = 128;
        i++;
        glClearColor(((2*i) &amp; 0xff) / 255.0f, 0.f, 1.f, (i &amp; 0xff) / 255.0f);
        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
        glFlush();
}

intptr_t event(const ev * e) {
        intptr_t ret = 1;
        cveventtype t = evType(e);
        switch (t) {
        case CVE_UPDATE: update(); break;
        default: ret = 0; break;
        }
        return ret;
}

/* 
   Local variables: **
   c-file-style: "bsd" **
   c-basic-offset: 8 **
   indent-tabs-mode: nil **
   End: **
*/
</pre>

</div>

</div>

<div id="outline-container-4-2" class="outline-3">
<h3 id="sec-4-2"><span class="section-number-3">4.2</span> Complete example handling all queries/events</h3>
<div class="outline-text-3" id="text-4-2">




<pre class="example">#include "cv.h"
#include "cvgl.h"

#if !defined NPAPI
#include &lt;stdio.h&gt;

static void report(const char * name, const char * s) {
        fprintf(stderr, "%s:%s", name, s);
}
#endif

static void init() {
        cvReport("init");
}

static void term() {
        cvReport("term");
}

static void glinit() {
        cvReport("glinit");
}

static int down(cvkey k) {
        int handled = 0;;
        cvReport("down %s", keyName(k));
        switch (k) {
        case CVK_MOUSELEFT:
                if (cvMouseY() &lt; 10)
                        cvShowKeyboard();
        default:
                handled = 0;
        }
        return handled;
}

static uint8_t cur[32*32*4] = {
        0xff,0x00,0x00,0xff, 
        0x00,0xff,0x00,0xff, 
        0x00,0x00,0xff,0xff, 
        0xff,0xff,0xff,0xff,
};

static int up(cvkey k) {
        int handled = 0;
        cvReport("up %s", keyName(k));
        switch (k) {
        case CVK_ESCAPE: cvQuit(); break;
        case CVK_H: cvHideCursor(); break;
        case CVK_D: cvDefaultCursor(); break;
        case CVK_C: cvSetCursor(cur, 0, 0); break;
        case CVK_F: cvFullscreen(); break;
        case CVK_W: cvWindowed(); break;
//        case CVK_RETURN: cvHideKeyboard(); break;
        default: handled = 0; break;
        }
        return handled;
}

static void unicode(uint32_t c) {
        cvReport("unicode %c", c);
}

static void motion(int x, int y) {
        cvReport("motion %d %d", x, y);
}

static void close() {
        cvReport("close");
        cvQuit();
}

static void invoke(const char * s) {
        cvReport("invoked method '%s'", s);
}

static void resize(unsigned w, unsigned h) {
        cvReport("resize %d %d", w, h);
        glViewport(0, 0, w, h);
}

static void update() {
        static int i = 128;
        i++;
        glClearColor(((2*i) &amp; 0xff) / 255.0f, 0.f, 1.f, (i &amp; 0xff) / 255.0f);
        glClear(GL_COLOR_BUFFER_BIT | GL_DEPTH_BUFFER_BIT);
        glFlush();
        if (cvPressed(CVK_A))
                cvReport("A pressed");
        if (cvReleased(CVK_A))
                cvReport("A released");
}

intptr_t event(const ev * e) {
        intptr_t ret = 1;
        cveventtype t = evType(e);
        if (t != CVE_UPDATE)
                cvReport("got event %s, %p %p", 
                         evName(e), evArg0(e), evArg1(e));
        switch (t) {
#if !defined NPAPI
        case CVQ_LOGGER: ret = (intptr_t)report; break;
#endif
        case CVQ_NAME: ret = (intptr_t)"test"; break;
        case CVQ_XPOS: ret = 50; break;
        case CVQ_YPOS: ret = 50; break;
        case CVQ_WIDTH: ret = 640; break;
        case CVQ_HEIGHT: ret = 480; break;
        case CVE_INIT: init(); break;
        case CVE_TERM: term(); break;
        case CVE_GLINIT: glinit(); break;
        case CVE_DOWN: ret = down(evWhich(e)); break;
        case CVE_UP: ret = up(evWhich(e)); break;
        case CVE_UNICODE: unicode(evUnicode(e)); break;
        case CVE_MOTION: motion(evX(e), evY(e)); break;
        case CVE_CLOSE: close(); break;
        case CVE_INVOKE: invoke(evMethod(e)); break;
        case CVE_RESIZE: resize(evWidth(e), evHeight(e)); break;
        case CVE_UPDATE: update(); break;
        default: ret = 0; break;
        }
        return ret;
}

/* 
   Local variables: **
   c-file-style: "bsd" **
   c-basic-offset: 8 **
   indent-tabs-mode: nil **
   End: **
*/
</pre>


</div>
</div>

</div>

<div id="outline-container-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> License</h2>
<div class="outline-text-2" id="text-5">

<p>  Copyright (c) 2011-2012, Jorge Acereda Maci√°
  All rights reserved.
</p>
<p>
  Redistribution and use in source and binary forms, with or without
  modification, are permitted provided that the following conditions are
  met:
</p>
<ol>
<li>Redistributions of source code must retain the above copyright
     notice, this list of conditions and the following disclaimer.

</li>
<li>Redistributions in binary form must reproduce the above copyright
     notice, this list of conditions and the following disclaimer in
     the documentation and/or other materials provided with the
     distribution.

</li>
<li>Neither the name of the author nor the names of its contributors
     may be used to endorse or promote products derived from this
     software without specific prior written permission.
</li>
</ol>


<p>
  THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
  "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
  LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
  A PARTICULAR PURPOSE ARE DISCLAIMED.  IN NO EVENT SHALL THE COPYRIGHT
  OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
  SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
  LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
  DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
  THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
  (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
  OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
</p></div>
</div>
</div>

<div id="postamble">
<p class="date">Date: 2011-10-02 Sun</p>
<p class="author">Author: Jorge Acereda</p>
<p class="creator"><a href="http://orgmode.org">Org</a> version 7.9.3f with <a href="http://www.gnu.org/software/emacs/">Emacs</a> version 24</p>
<a href="http://validator.w3.org/check?uri=referer">Validate XHTML 1.0</a>

</div>
</body>
</html>
